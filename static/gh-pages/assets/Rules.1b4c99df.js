var B=Object.defineProperty,j=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var g=(e,t,r)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,u=(e,t)=>{for(var r in t||(t={}))S.call(t,r)&&g(e,r,t[r]);if(_)for(var r of _(t))$.call(t,r)&&g(e,r,t[r]);return e},v=(e,t)=>j(e,F(t));import{e as A,u as y,N as L,U as E,V as b,r as l,k as w,R as o}from"./vendor.287bb476.js";import{a as Q,V as W}from"./index.esm.a8ab14ff.js";import{t as h,E as z,B as D,c as U,g as V,C as H}from"./index.0a3b6133.js";import{R as P,T as q}from"./TextFitler.6d6b0fd4.js";import{f as M}from"./index.9233837d.js";import{F as O,p as G}from"./Fab.6c872d55.js";import{u as J}from"./useRemainingViewPortHeight.64e0bd8d.js";import"./debounce.76599460.js";function K(e){const t=e.providers,r=Object.keys(t),s={};for(let n=0;n<r.length;n++){const a=r[n];s[a]=v(u({},t[a]),{idx:n})}return{byName:s,names:r}}async function X(e,t){const{url:r,init:s}=h(t);let n={providers:{}};try{const a=await fetch(r+e,s);a.ok&&(n=await a.json())}catch(a){console.log("failed to GET /providers/rules",a)}return K(n)}async function x({name:e,apiConfig:t}){const{url:r,init:s}=h(t);try{return(await fetch(r+`/providers/rules/${e}`,u({method:"PUT"},s))).ok}catch(n){return console.log("failed to PUT /providers/rules/:name",n),!1}}async function Y({names:e,apiConfig:t}){for(let r=0;r<e.length;r++)await x({name:e[r],apiConfig:t})}var Z=function(e,t,r,s,n,a,i,d){if(!e){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=[r,s,n,a,i,d],k=0;c=new Error(t.replace(/%s/g,function(){return f[k++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}},ee=Z;function te(e){return ee(e.rules&&e.rules.length>=0,"there is no valid rules list in the rules API response"),e.rules.map((t,r)=>v(u({},t),{id:r}))}async function re(e,t){let r={rules:[]};try{const{url:s,init:n}=h(t),a=await fetch(s+e,n);a.ok&&(r=await a.json())}catch(s){console.log("failed to fetch rules",s)}return te(r)}const I=A({key:"ruleFilterText",default:""});function ne(e,t){const r=E(),{mutate:s,isLoading:n}=b(x,{onSuccess:()=>{r.invalidateQueries("/providers/rules")}});return[i=>{i.preventDefault(),s({name:e,apiConfig:t})},n]}function se(e){const t=E(),{data:r}=N(e),{mutate:s,isLoading:n}=b(Y,{onSuccess:()=>{t.invalidateQueries("/providers/rules")}});return[i=>{i.preventDefault(),s({names:r.names,apiConfig:e})},n]}function N(e){return y(["/providers/rules",e],()=>X("/providers/rules",e))}function ae(e){const{data:t,isFetching:r}=y(["/rules",e],()=>re("/rules",e)),{data:s}=N(e),[n]=L(I);if(n==="")return{rules:t,provider:s,isFetching:r};{const a=n.toLowerCase();return{rules:t.filter(i=>i.payload.toLowerCase().indexOf(a)>=0),isFetching:r,provider:{byName:s.byName,names:s.names.filter(i=>i.toLowerCase().indexOf(a)>=0)}}}}const oe="_RuleProviderItem_iorw0_1",ie="_left_iorw0_16",le="_middle_iorw0_23",ce="_gray_iorw0_29",ue="_refreshButtonWrapper_iorw0_38";var m={RuleProviderItem:oe,left:ie,middle:le,gray:ce,refreshButtonWrapper:ue};function me({idx:e,name:t,vehicleType:r,behavior:s,updatedAt:n,ruleCount:a,apiConfig:i}){const[d,c]=ne(t,i),f=M(new Date(n),new Date);return l.exports.createElement("div",{className:m.RuleProviderItem},l.exports.createElement("span",{className:m.left},e),l.exports.createElement("div",{className:m.middle},l.exports.createElement(z,{name:t,type:`${r} / ${s}`}),l.exports.createElement("div",{className:m.gray},a<2?`${a} rule`:`${a} rules`),l.exports.createElement("small",{className:m.gray},"Updated ",f," ago")),l.exports.createElement("span",{className:m.refreshButtonWrapper},l.exports.createElement(D,{onClick:d,disabled:c},l.exports.createElement(P,{isRotating:c}))))}function de({apiConfig:e}){const[t,r]=se(e),{t:s}=w();return l.exports.createElement(O,{icon:l.exports.createElement(P,{isRotating:r}),text:s("update_all_rule_provider"),style:G,onClick:t})}const fe="_rule_1a38b_1",pe="_left_1a38b_12",ve="_a_1a38b_19",he="_b_1a38b_26",Re="_type_1a38b_37";var p={rule:fe,left:pe,a:ve,b:he,type:Re};const R={_default:"#59caf9",DIRECT:"#f5bc41",REJECT:"#cb3166"};function _e({proxy:e}){let t=R._default;return R[e]&&(t=R[e]),{color:t}}function ge({type:e,payload:t,proxy:r,id:s}){const n=_e({proxy:r});return o.createElement("div",{className:p.rule},o.createElement("div",{className:p.left},s),o.createElement("div",null,o.createElement("div",{className:p.b},t),o.createElement("div",{className:p.a},o.createElement("div",{className:p.type},e),o.createElement("div",{style:n},r))))}const ye="_header_1j1w3_1",Ee="_RuleProviderItemWrapper_1j1w3_17";var C={header:ye,RuleProviderItemWrapper:Ee};const{memo:be}=o,T=30;function we(e,{rules:t,provider:r}){const s=r.names.length;return e<s?r.names[e]:t[e-s].id}function Pe({provider:e}){return function(r){const s=e.names.length;return r<s?90:80}}const xe=be(({index:e,style:t,data:r})=>{const{rules:s,provider:n,apiConfig:a}=r,i=n.names.length;if(e<i){const c=n.names[e],f=n.byName[c];return o.createElement("div",{style:t,className:C.RuleProviderItemWrapper},o.createElement(me,u({apiConfig:a},f)))}const d=s[e-i];return o.createElement("div",{style:t},o.createElement(ge,u({},d)))},Q),Ie=e=>({apiConfig:V(e)});var Le=U(Ie)(Ne);function Ne({apiConfig:e}){const[t,r]=J(),{rules:s,provider:n}=ae(e),a=Pe({provider:n}),{t:i}=w();return o.createElement("div",null,o.createElement("div",{className:C.header},o.createElement(H,{title:i("Rules")}),o.createElement(q,{placeholder:"Filter",textAtom:I})),o.createElement("div",{ref:t,style:{paddingBottom:T}},o.createElement(W,{height:r-T,width:"100%",itemCount:s.length+n.names.length,itemSize:a,itemData:{rules:s,provider:n,apiConfig:e},itemKey:we},xe)),n&&n.names&&n.names.length>0?o.createElement(de,{apiConfig:e}):null)}export{Le as default};
